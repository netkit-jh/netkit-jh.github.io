(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{176:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return d})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return h})),t.d(n,"default",(function(){return g}));var o=t(3),s=t(7),r=(t(0),t(194)),i=t(196);var a=t.n(i)()("\n<h1>NAME</h1>\n<p>vclean - cleanup netkit processes and configurations</p>\n<h1>SYNOPSIS</h1>\n<p><strong>vclean</strong> [options]</p>\n<h1>DESCRIPTION</h1>\n<p>The <em>vclean</em> command can be used to perform some cleanup operations on the host machine. In order to run virtual machines, Netkit launches several processes and sometimes performs some configuration changes (e.g., when setting up ''<strong>tap</strong>'' collision domains \u2013 see <strong>vstart</strong>(1) \u2013). After stopping all the virtual machines the system is reverted to its original state. Nevertheless, sometimes it may be useful (or even necessary) to force a cleanup which stops hanging processes and removes any configuration change. In this sense, <em>vclean</em> can be considered as the Netkit ''panic button''.</p>\n<p>The use of <em>vclean</em> becomes necessary in (at least) the following situations:</p>\n<dl>\n<dt>\u2013</dt>\n<dd><p>A network interface has been connected to a ''<strong>tap</strong>'' collision domain. After halting (or crashing) some virtual machines, the ''<strong>tap</strong>'' collision domain is not used any more and the corresponding configuration settings must be removed (see <strong>vstart</strong>(1) for a description of ''<strong>tap</strong>'' collision domains).</p>\n</dd>\n<dt>\u2013</dt>\n<dd><p>A network interface has been attached ''on the fly'' to a running virtual machine by using <strong>vconf</strong> (see <strong>vconf</strong>(1)). After halting (or crashing) the machine, the corresponding virtual hub is still running and must be terminated.</p>\n</dd>\n</dl>\n<p><em>vclean</em> can perform several cleanup operations. If invoked without options, it just scans for virtual hubs launched by the current user that are still running but no longer used (i.e., there is no virtual machine that is connected to them). If any of the options listed below is provided, then only the requested action is performed. It is also possible to perform several actions in a single run.</p>\n<dl>\n<dt><strong>--clean-all</strong></dt>\n<dd><p>This option tells <em>vclean</em> to perform all the cleanup operations listed below. It is a shortcut for <strong>-HKT</strong>.<br />\nPlease <strong>use this option with care</strong>: depending on the other command line switches you are using, this <strong>may kill virtual machines started by any user</strong>!</p>\n</dd>\n<dt><strong>-H</strong></dt>\n<dd>\n</dd>\n</dl>\n<dl>\n<dt><strong>--remove-hubs</strong></dt>\n<dd><p>Terminate running virtual hubs (collision domains) that are not used any more (i.e., those that have no virtual machines attached). This is the default action when <em>vclean</em> is invoked without options.</p>\n</dd>\n<dt><strong>-K</strong></dt>\n<dd>\n</dd>\n</dl>\n<dl>\n<dt><strong>--kill-machines</strong></dt>\n<dd><p>Terminate all running virtual machines and virtual hubs. Virtual machines are killed in the same way as the ''vcrash -k'' command would do (see <strong>vcrash</strong>(1)).<br />\nThis is probably the most effective ''panic button''. In fact, using this option should result in getting rid of all Netkit processes, even the hanging ones (unless they are hanging so hard that only a reboot can destroy them).</p>\n</dd>\n<dt><strong>-T</strong></dt>\n<dd>\n</dd>\n</dl>\n<dl>\n<dt><strong>--remove-tunnels</strong></dt>\n<dd><p>When using an interface attached to a ''<strong>tap</strong>'' collision domain for the first time, <em>vstart</em> (or <em>vconf</em>, depending on the command you have been using to configure the interface \u2013 see <strong>vstart</strong>(1), <strong>vconf</strong>(1)) takes care of automatically configuring the necessary host-side settings and, if found, also the iptables firewall. For details about the configuration parameters being altered, see <strong>vstart</strong>(1).</p>\n</dd>\n</dl>\n<p>This option removes any host-side configurations and restores the previous firewall settings. More precisely, the following operations are performed:</p>\n<p>1) If the iptables firewall is found, then both masquerading and packet forwarding for data passing through tap interfaces are disabled. In particular, the following rules are removed:</p>\n<pre><code>*nat\n-A POSTROUTING -j MASQUERADE\n*filter\n-A FORWARD -i nk_tap_+ -j ACCEPT</code></pre>\n<p><br />\n2) Kernel IP forwarding is disabled by echoing '0' to the special file</p>\n<p>'/proc/sys/net/ipv4/ip_forward'.</p>\n<p><br />\n3) Every tap interface (on the host side) is brought down and the corresponding tap device is removed.<br />\n4) Permissions for the '/dev/net/tun' device are set to 660 (read/write for its owner and for other users in the same group; no permissions for other users).</p>\n<p>These operations require administrative privileges. The <em>vclean</em> command will take care of asking you for a password if needed. For more information about how Netkit gains root privileges, see <strong>USE_SUDO</strong> and <strong>SETTING UP NETKIT FOR USE WITH SUDO</strong> in the man page of <strong>netkit.conf</strong>(5).</p>\n<p><strong>Notice</strong>: this action is in no way influenced by the <strong>--user</strong> option. Using <strong>--remove-tunnels</strong> or <strong>-T</strong> causes all host-side configurations to be removed, regardless of the user who had requested them.</p>\n<dl>\n<dt><strong>--test</strong></dt>\n<dd><p>Instead of terminating virtual hubs and/or virtual machines, just show which processes would be killed. This option cannot be used together with <strong>-q</strong> (<strong>--quick</strong>, <strong>--quiet</strong>). Action <strong>--remove-tunnels</strong> is not affected by the use of <strong>--test</strong>.</p>\n</dd>\n<dt><strong>-u <em>USERNAME</em></strong></dt>\n<dd>\n</dd>\n</dl>\n<dl>\n<dt><strong>--user=<em>USERNAME</em></strong></dt>\n<dd><p>This options limits the scope of the above actions to virtual machines and hubs owned by user <em>USERNAME</em>. By default, <em>vclean</em> only terminates machines and hubs owned by the current user (i.e., the one who launched <em>vclean</em>). The special user name '<strong>-</strong>' is reserved, and can be used to perform cleanup actions on every machine and hub, regardless of the user who started it. Please <strong>use the '--user=-' or '-u -' option with extreme care</strong>: depending on the options you are using, this <strong>may crash ALL virtual machines that are currently</strong> running on the host machine.</p>\n</dd>\n</dl>\n<p>Action <strong>--remove-tunnels</strong> is not affected by this option.</p>\n<p>Other supported options are:</p>\n<dl>\n<dt><strong>-h</strong></dt>\n<dd>\n</dd>\n</dl>\n<dl>\n<dt><strong>--help</strong></dt>\n<dd><p>Show usage information.</p>\n</dd>\n<dt><strong>-q</strong></dt>\n<dd>\n</dd>\n</dl>\n<dl>\n<dt><strong>--quick</strong></dt>\n<dd>\n</dd>\n</dl>\n<dl>\n<dt><strong>--quiet</strong></dt>\n<dd><p>By default, after killing processes <em>vclean</em> checks whether they have actually stopped. This option disables these checks, thus quickening the execution of <em>vclean</em>. It also suppresses any output, except errors and warnings.</p>\n</dd>\n</dl>\n<p>This option cannot be used in conjunction with <strong>--test</strong>.</p>\n<dl>\n<dt><strong>--version</strong></dt>\n<dd><p>Print information about the installed Netkit release and the host kernel version and exit. If ''<em>&lt;unavailable&gt;</em>'' is printed instead of a version number, then the corresponding information could not be retrieved (for example because a non-standard Netkit kernel or filesystem is being used).</p>\n</dd>\n</dl>\n<h1>ENVIRONMENT VARIABLES</h1>\n<p>All Netkit commands require that the <strong>NETKIT_HOME</strong> variable contains the name of the directory Netkit is installed in.</p>\n<p>Apart from this, <em>vclean</em> supports no other environment variables.</p>\n<h1>NOTES</h1>\n<p><em>vclean</em> has nothing to do with <strong>lclean</strong>(1). While the former works as a vacuum cleaner for unused and/or hanging Netkit processes, the latter is a tool to clean up directories containing Netkit labs. In particular, <em>vclean</em> works on processes (which have not necessarily been originated in a Netkit lab) and, optionally, on the system configuration (to remove tunnels and firewall settings), while <strong>lclean</strong>(1) works on the host filesystem (with the purpose of cleaning up temporary files created after running a Netkit lab).</p>\n<h1>SEE ALSO</h1>\n<p><em>lclean</em>(1), <em>vconf</em>(1), <em>vcrash</em>(1), <em>vhalt</em>(1), <em>vlist</em>(1), <em>vstart</em>(1).</p>\n<h1>AUTHOR</h1>\n<p><strong>vclean</strong> script: Massimo Rimondini<br />\nThis man page: Massimo Rimondini</p>\n<h1>REPORTING BUGS</h1>\n<p>Report bugs to the Github issues page: https://github.com/netkit-jh/netkit-jh-build/issues</p>\n<p>Please follow the recommended templates when reporting bugs.</p>\n"),d={id:"netkit-manpage-vclean",title:"vclean - manpage",sidebar_label:"vclean",custom_edit_url:"https://github.com/netkit-jh/netkit-jh-build/tree/master/core/man",keywords:["netkit","netkit-jh","manpage","man","vclean"]},l={unversionedId:"man/netkit-manpage-vclean",id:"man/netkit-manpage-vclean",isDocsHomePage:!1,title:"vclean - manpage",description:"{html}",source:"@site/docs/man/vclean.md",slug:"/man/netkit-manpage-vclean",permalink:"/docs/next/man/netkit-manpage-vclean",editUrl:"https://github.com/netkit-jh/netkit-jh-build/tree/master/core/man",version:"current",sidebar_label:"vclean",sidebar:"docsSidebar",previous:{title:"Adding New Configuration Options to netkit.conf",permalink:"/docs/next/dev/guides/addingnewconfigs"},next:{title:"vcommand - manpage",permalink:"/docs/next/man/netkit-manpage-vcommand"}},h=[],c={toc:h};function g(e){var n=e.components,t=Object(s.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},c,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("div",null,a))}g.isMDXComponent=!0},197:function(e,n){}}]);