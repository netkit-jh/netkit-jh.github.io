<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Netkit-JH Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Netkit-JH Docs Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Netkit-JH Docs" href="/opensearch.xml"><title data-react-helmet="true">Adding a New Linux Distribution to Netkit-JH | Netkit-JH Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="1.1.3"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-1.1.3"><meta data-react-helmet="true" property="og:title" content="Adding a New Linux Distribution to Netkit-JH | Netkit-JH Docs"><meta data-react-helmet="true" name="description" content="Download this Repo"><meta data-react-helmet="true" property="og:description" content="Download this Repo"><meta data-react-helmet="true" property="og:url" content="https://netkit-jh.github.io/docs/dev/guides/add_distro"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://netkit-jh.github.io/docs/dev/guides/add_distro"><link rel="stylesheet" href="/styles.e0ae11cf.css">
<link rel="preload" href="/styles.de6f61a5.js" as="script">
<link rel="preload" href="/runtime~main.6929f4e1.js" as="script">
<link rel="preload" href="/main.863bb332.js" as="script">
<link rel="preload" href="/2.9f8a7d15.js" as="script">
<link rel="preload" href="/121.d9a1da81.js" as="script">
<link rel="preload" href="/124.900ef96b.js" as="script">
<link rel="preload" href="/d912a3d1.e8dfff67.js" as="script">
<link rel="preload" href="/120.df8738d5.js" as="script">
<link rel="preload" href="/4176ef4f.cbb820de.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="netkit-jh-logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="netkit-jh-logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Netkit-JH Docs</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">1.1.3</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/dev/guides/add_distro">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/dev/guides/add_distro">1.1.3</a></li><li><a class="dropdown__link" href="/docs/1.0.0/">1.0.0</a></li></ul></div><a href="https://github.com/netkit-jh/netkit-jh-build" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="netkit-jh-logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="netkit-jh-logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Netkit-JH Docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/dev/guides/add_distro">Next</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/dev/guides/add_distro">1.1.3</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/1.0.0/">1.0.0</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/netkit-jh/netkit-jh-build" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Netkit</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction">Introduction Lab</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/usingtmux">Using Tmux</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dev/gettingstarted">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dev/featuresinprogress">Upcoming Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dev/currentbugs">Bugs</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dev/guides/debianbuild">Building Netkit-JH</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dev/guides/dockerbuild">Building with Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dev/guides/tcpdump">Building TCPDump</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dev/guides/fspackages">Installing Additional Packages</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/dev/guides/add_distro">Add a Distro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dev/guides/kernelpatches">Creating Kernel Patches</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dev/guides/creatingtests">Creating Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dev/guides/addingnewconfigs">Adding Config Options</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Manpages</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">vm commands</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-vclean">vclean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-vcommand">vcommand</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-vconfig">vconfig</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-vconnect">vconnect</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-vcrash">vcrash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-vdump">vdump</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-vhalt">vhalt</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-vlist">vlist</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-vstart">vstart</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">lab commands</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-lclean">lclean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-lcrash">lcrash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-lhalt">lhalt</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-linfo">linfo</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-lrestart">lrestart</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-lstart">lstart</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-ltest">ltest</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-lab.conf">lab.conf</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-lab.dep">lab.dep</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-netkit.conf">netkit.conf</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/man/netkit-manpage-netkit">netkit</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Docs Site</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/website/start">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/website/doc">Writing Docs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/website/blog">Writing Blog Posts</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><div><span class="badge badge--secondary">Version: 1.1.3</span></div><header><h1 class="docTitle_Oumm">Adding a New Linux Distribution to Netkit-JH</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="download-this-repo"></a>Download this Repo<a class="hash-link" href="#download-this-repo" title="Direct link to heading">#</a></h2><p>To get a local copy of this repo on the vm run:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/netkit-jh/netkit-jh-build.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> netkit-jh-build</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> checkout multi-distro</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The multi-distro feature is in progress, you will need to use the multi-distro branch.
There is currently no method of specifying a filesystem with a netkit lab, it just uses the one at $NETKIT_HOME/fs/netkit-fs. This guide is currently just for testing and experimenting.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="adding-a-distro"></a>Adding a Distro<a class="hash-link" href="#adding-a-distro" title="Direct link to heading">#</a></h2><p>To add a distro, first create a directory in the <code>distros</code> directory, with the name of the new distro. For example if I wanted to add Arch Linux, I might name the directory &#x27;arch&#x27;.</p><p>Within this directory you will need:</p><ul><li>A directory called <code>filesystem-tweaks</code> (Optional)</li><li>A file called <code>bootstrap.sh</code></li><li>A file called <code>pre-install-netkit-fs.sh</code></li><li>A file called <code>post-install-netkit-fs.sh</code></li><li>A file called <code>packages-list</code></li><li>A file called <code>enabled-services</code></li><li>A file called <code>disabled-services</code></li><li>A file called <code>distro.env</code></li></ul><p>If any of the files are missing, the build will not work. If the filesystem-tweaks directory is missing it will be created during the build process.</p><p>An easy way to start is by copying the <a href="https://github.com/netkit-jh/netkit-jh-build/tree/multi-distro/fs/distros/template" target="_blank" rel="noopener noreferrer">template</a> directory.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Netkit-JH uses systemd in the current distros. It is recommended but not required that any distros you add also use systemd. If not you will probably need to make a lot more distro filesystem-tweaks!</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="filesystem-tweaks"></a>Filesystem Tweaks<a class="hash-link" href="#filesystem-tweaks" title="Direct link to heading">#</a></h3><p><code>filesystem-tweaks</code> allows you to create files which will end up in the final filesystem image, with <code>filesystem-tweaks/</code> representing <code>/</code>. For example, you might want to add a config file to <code>/etc/test.conf</code>, so you would place the file at <code>filesystem-tweaks/etc/test.conf</code>.</p><p>There are global and per-distro filesystem tweaks. To add a file for all distros, place the file within
<code>netkit-jh-build/fs/filesystem-tweaks/...</code>, or to add a file for a specific distro, place it within
<code>netkit-jh-build/fs/distros/DISTRO/filesystem-tweaks/...</code>. The global changes are applied first then the
distro specific changes (this will overwrite global tweaks).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="bootstrap"></a>Bootstrap<a class="hash-link" href="#bootstrap" title="Direct link to heading">#</a></h3><p>The file <code>netkit-jh-build/fs/distros/DISTRO/bootstrap.sh</code> needs to be a script that will bootstrap (build the base filesystem) for the distro. This can use tools like pacstrap, debootstrap, multistrap etc.</p><p><code>bootstrap.sh</code> will be called with the following arguments:</p><ul><li>$1 - the mount directory (the path to where you should install the base OS)</li><li>$2 - the distro directory (the path to <code>netkit-jh-build/fs/distros/DISTRO</code>)</li></ul><p>Configuration options can be placed directly in the script but it is recommended to place them in <code>distro.env</code>, and then source this in the bootstrap script. This means you can then easily change things such as distro release and mirrors from the <code>distro.env</code> file.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="custom-install-scripts"></a>Custom Install Scripts<a class="hash-link" href="#custom-install-scripts" title="Direct link to heading">#</a></h3><p>The script <code>pre-install-netkit-fs.sh</code> is run before the <a href="https://github.com/netkit-jh/netkit-jh-build/blob/multi-distro/fs/install-netkit-fs.sh" target="_blank" rel="noopener noreferrer">global install script</a> and <code>post-install-netkit-fs.sh</code> is run afterwards.</p><p>The main (shared) install script contains key installation steps including:</p><ul><li>installing packages from the packages-list</li><li>copying the filesystem-tweaks to the filesystem</li><li>setting up netkit specific services</li><li>copying in kernel modules</li><li>enabling and disabling systemd services</li></ul><p>When deciding whether to put commands in the pre or the post install script, you should consider how the above operations would be affected by / would affect the commands.</p><p>These scripts are called with the following arguments:</p><ul><li>$1 - the work directory netkit-jh-build/fs (which contains global filesystem tweaks)</li><li>$2 - the build directory (which contains the filesystem version file)</li><li>$3 - the mount directory (where the filesystem is mounted)</li><li>$4 - the kernel modules directory (where the built kernel modules are)</li><li>$5 - the distro directory (the path to the distro files - netkit-jh/fs/distros/DISTRO)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="package-selections"></a>Package Selections<a class="hash-link" href="#package-selections" title="Direct link to heading">#</a></h3><p>The file <code>packages-list</code> should contain a list of packages to be installed in the main install script.</p><p>When adding a package make sure the repository is enabled / added to the filesystem - it may be necessary to add to the <code>pre-install-netkit-fs.sh</code> script to add repos.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="systemd-services"></a>Systemd Services<a class="hash-link" href="#systemd-services" title="Direct link to heading">#</a></h3><p>The file <code>enabled-services</code> should contain a list of services to enable, and <code>disabled-services</code> should contain a list of services to disable - quite self explanatory :)</p><p>You should consider disabling services that may be enabled by the packages you install - as we want to keep netkit machines lightweight, it is better to enable a service in a <code>.startup</code> file rather than have it enabled by default if its not going to be needed by the majority of netkit machines.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="distro-config"></a>Distro Config<a class="hash-link" href="#distro-config" title="Direct link to heading">#</a></h3><p><code>distro.env</code> MUST contain a variable INSTALL_COMMAND which should be set to the command to install a package on a distro.
During the main install script, the packages list will be looped through and for each package, it will run <code>$INSTALL_COMMAND packageN</code>.</p><p>You can also include other variables that may be useful in installation scripts - for example you might want to have variables for the distro release and mirror used in <code>bootstrap.sh</code>. This makes <code>distro.env</code> into a config file of sorts, meaning it is cleaner and easier to make changes as its all in one place.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="build-the-new-filesystem"></a>Build the New Filesystem<a class="hash-link" href="#build-the-new-filesystem" title="Direct link to heading">#</a></h2><p>Build the filesystem as shown in the <a href="/docs/dev/guides/dockerbuild">docker</a> or <a href="/docs/dev/guides/debianbuild">vm</a> guide, depending on your development environment.
When finished, the filesystem should appear as a tarfile in the root of the netkit-jh-build directory, with a name similar to netkit-fs-0.1.8.tar.bz2 (but with a different version number).</p><p>You will need to specify the distro you want to build in the make command, otherwise it will default to debian. The DISTRO name must match the directory name created in &#x27;distros&#x27;.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">make</span><span class="token plain"> build-fs </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">distro</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">DISTRO</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>or if using <a href="/docs/dev/guides/dockerbuild">docker</a> to build, make sure to give the environment flag with the make arguments: <code>-e MAKE_ARGS=&quot;build-fs distro=DISTRO</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="test-the-new-filesystem"></a>Test the New Filesystem<a class="hash-link" href="#test-the-new-filesystem" title="Direct link to heading">#</a></h2><p>Extract the filesystem to a different location to your main install (you don&#x27;t want to override the filesystem in $NETKIT_HOME in case there are problems with the filesystem!).</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> nk_test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> nk_test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">tar</span><span class="token plain"> -xvf netkit-fs-0.1.8.tar.bz2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">ls</span><span class="token plain"> -lha </span><span class="token variable" style="color:rgb(191, 199, 213)">$NETKIT_HOME</span><span class="token plain">/fs </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># take note of where the symbolic link netkit-fs points to</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">ln</span><span class="token plain"> -sfn netkit-ng/fs/netkit-fs-0.1.8 </span><span class="token variable" style="color:rgb(191, 199, 213)">$NETKIT_HOME</span><span class="token plain">/fs/netkit-fs</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now you can run a Netkit lab and test if your software package has been installed on the filesystem.</p><p>After testing, you might want to revert to using the original netkit filesystem that was installed by default.
To do this simply change the symbolic link back with:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">ln</span><span class="token plain"> -sfn </span><span class="token variable" style="color:rgb(191, 199, 213)">$NETKIT_HOME</span><span class="token plain">/fs/netkit-fs-0.1.8 </span><span class="token variable" style="color:rgb(191, 199, 213)">$NETKIT_HOME</span><span class="token plain">/fs/netkit-fs</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Replace the <code>$NETKIT_HOME/fs/netkit-fs-0.1.8</code> in the last command with the file which was originally pointed to by the symbolic link</p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/netkit-jh/netkit-jh.github.io/edit/main/versioned_docs/version-1.1.3/dev/guides/newdistro.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/dev/guides/fspackages"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Installing Additional Packages</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/dev/guides/kernelpatches"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Creating Kernel Patches Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#download-this-repo" class="table-of-contents__link">Download this Repo</a></li><li><a href="#adding-a-distro" class="table-of-contents__link">Adding a Distro</a><ul><li><a href="#filesystem-tweaks" class="table-of-contents__link">Filesystem Tweaks</a></li><li><a href="#bootstrap" class="table-of-contents__link">Bootstrap</a></li><li><a href="#custom-install-scripts" class="table-of-contents__link">Custom Install Scripts</a></li><li><a href="#package-selections" class="table-of-contents__link">Package Selections</a></li><li><a href="#systemd-services" class="table-of-contents__link">Systemd Services</a></li><li><a href="#distro-config" class="table-of-contents__link">Distro Config</a></li></ul></li><li><a href="#build-the-new-filesystem" class="table-of-contents__link">Build the New Filesystem</a></li><li><a href="#test-the-new-filesystem" class="table-of-contents__link">Test the New Filesystem</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/about">About Netkit</a></li><li class="footer__item"><a class="footer__link-item" href="/docs">Installing Netkit</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/netkit-jh/netkit-jh-build" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Netkit-JH Docs. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.de6f61a5.js"></script>
<script src="/runtime~main.6929f4e1.js"></script>
<script src="/main.863bb332.js"></script>
<script src="/2.9f8a7d15.js"></script>
<script src="/121.d9a1da81.js"></script>
<script src="/124.900ef96b.js"></script>
<script src="/d912a3d1.e8dfff67.js"></script>
<script src="/120.df8738d5.js"></script>
<script src="/4176ef4f.cbb820de.js"></script>
</body>
</html>